<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en" class="no-js"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en" class="no-js"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en" class="no-js"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en" class="no-js"> <!--<![endif]-->

<head>
	<meta charset="utf-8">
	<title>Ken Egozi | Web builder</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="description" content="Ken Egozi's homepage">
	<meta name="author" content="Ken Egozi">
	<meta content="Ken Egozi's homepage" property='og:description'>
	<meta content='summary' name='twitter:card'>
	<meta content='@kenegozi' name='twitter:site'>
	<meta content='Ken Egozi | Web builder' property='og:title'>
	
	<link rel="canonical" href="http://kenegozi.com/blog/tag/activerecord/index.html" />

	<link rel="stylesheet" href="/assets/stylesheets/bootstrap.css" />
	<link rel="stylesheet" href="/assets/stylesheets/main.css" />

	<!-- Google Fonts -->
	<link href='http://fonts.googleapis.com/css?family=Dosis:300,400,500,600,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,300,400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:700' rel='stylesheet' type='text/css'>
	<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type='text/css'>

	<!-- IE 9 Fallback-->
	<!--[if IE 9]>
		<link href="/assets/css/ie.css" rel="stylesheet">
	<![endif]-->

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements and IE Fallback-->
	<!--[if lt IE 9]>
	  <script src="/assets/js/html5shiv.js"></script>
	<![endif]-->

	<!-- Fav and touch icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="/assets/img/apple-touch-icon-57-precomposed.png">
	<link rel="shortcut icon" href="/assets/img/favicon.ico">
</head>
<body id="top" class="">
	
	<!-- NAVBAR -->
	<div class="navbar navbar-fixed-top navbar-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
					<span class="sr-only">Menu</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<nav class="navbar-collapse collapse" id="main-nav" role="navigation">
				<ul class="nav navbar-nav navbar-right">
					
					<li><a href="/">home</a></li>
					<li><a href="/#about">about</a></li>
					<li><a href="/#blog">blog</a></li>
					<li><a href="/#contact">contact</a></li>
				</ul>
			</nav>
		</div>
	</div>
	<!-- END NAVBAR -->
<section class="container content tags">
  <h1 class="post_title">Posts Tagged &ldquo;activerecord&rdquo;</h1>
  <div class="post-sidebar">
	<h5>Follow</h5>
	<p>
		<a href="http://feeds2.feedburner.com/kenegozi">
			<img src="http://feeds.feedburner.com/~fc/kenegozi?bg=000033&amp;fg=00FF00&amp;anim=1" height="26" width="88" style="border:0" alt="">
		</a>
	</p>
	<hr/>
</div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2010/01/05/nhibernate-and-activerecordrsquos-showsql-in-web-application">NHibernate (and ActiveRecord&rsquo;s) show_sql in web application</a></h2>
    <div class="meta">
        <time>on January 5, 2010</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            ,&nbsp;
            
            <a href="/blog/tag/aspview" rel="tag">aspview</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            
            
        </span>
        
    </div>
    
     <p>Looking into
When using an OR/M of any kind, it is quite worthwhile to be able to look at the SQL generated by the tool, for various reasons (such as tuning the DB, finding SELECT N+1 issues, and sheer curiosity).</p>

<p> 
Solution #1
One way of doing that is to start a profiler on the DB engine, but it has its downsides. For one, you would need a profiler tool, which is not always freely available. You might also not be able to access the DB engine with that kind of tool on various hosted environments.</p>

<p> </p>

<p>In NHibernate’s configuration (and it is also exposed to Castle’s ActiveRecord users) you can set a property names “show_sql” to true. This will cause NHibernate to spit every SQL query, along with its parameters, onto the Console. Very useful when running Tests, but when running within a Web Application, you do not have access to the Console window, and can’t really see what is going on.</p>

<p>That also leads to another problem with using a profiler on the DB engine – you won’t be able to figure out which queries belong to which web request.</p>

<p> 
Solution #2
One comprehensive solution is to use the excellent tool from <a href="http://ayende.com/">Oren Eini</a> – NhProf. I will not cover this tool here; it does lots of great stuff, and can help your development cycle. However not everyone will be willing to pay the price for using it.</p>

<p> </p>

<p>not to worry, I hereby offer you two more options, which gives you less options, but are good enough for the problem at hand, and are free.</p>

<p> 
Free solution #1
NHibernate is using log4net. it stores a <em>lot</em> of what it’s doing there. So, one can always setup a logger named “NHibernate.SQL” and get a hold of the queries. I do not cover log4net usage here. Google it up, and then set up the NHibernate.SQL logger.</p>

<p>You’d also want to setup a log4net variable for you to group the queries it gets by the web-request that needed them. You can do so by setting a property on log4net’s GlobalContext. e.g., in Application_BeginRequest:</p>

<p><code>
log4net.GlobalContext.Properties[&amp;quot;page_url&amp;quot;] = Context.Request.RawUrl + &amp;quot;|&amp;quot; + Guid.NewGuid();
</code></p>

<p>then you’d set the log appender to write the page_url value, and you’ll be able to Group By it.</p>

<p> </p>

<p> </p>

<p>But this suck. You need to depend on log4net even if you do not want to, and setup that hack-ish global property, then read it from the log4net storage, and lots of complexities. wouldn’t it be great if you could simply got a hold of the Console’s output (or at least the NH parts of it?)</p>

<p> 
Free solution #2 – even simpler
The Console object allow you to set a custom Writer to its Out stream. Meaning, you can grab the Console’s output into an in memory string during a request, and then at the end of the request, grab all lines that starts with “NHibernate:” and you’re done:</p>

<p> </p>

<p>on Application_BeginRequest:</p>

<p><code>
var writer = new StringWriter();
Console.SetOut(writer);
Context.Items[SqlLogFilter.SQL_LOG_WRITER_KEY] = writer;
</code></p>

<p>on Application_EndRequest:</p>

<p><code>
var writer = HttpContext.Current.Items[SQL_LOG_WRITER_KEY] as StringWriter;
if (writer != null)
{
	var lines = writer.ToString().Split(new[] { Environment.NewLine }, StringSplitOptions.RemoveEmptyEntries);
	var relevantLines =
		lines.Where(l =&gt; l.StartsWith(&amp;quot;NHibernate&amp;quot;) || l.Length &gt; 0 &amp;amp;&amp;amp; char.IsWhiteSpace(l[0])).ToArray()
		;
	var queries = string.Join(Environment.NewLine, relevantLines)
		.Split(new[] {&amp;quot;NHibernate:&amp;quot;}, StringSplitOptions.RemoveEmptyEntries)
		.Select(q =&gt; q.Trim());
	DoSomethingWith(queries);
}
</code></p>

<p> </p>

<p>within DoSomethingWith you can do whatever you like with the queries string collection</p>

<p> </p>

<p>The more complete solution that I use, is taking advantage of a feature in Monorail’s AspView called <a href="http://kenegozi.com/blog/2007/11/13/viewfilter-take-2.aspx">ViewFilter</a> (you can do this with ASP.NET’s output filter; look up HttpFilter. it’s not as clean, but workable). I create a filter that wrap the stuff that’s on the Application_EndRequest, turn the queries collection into a bunch of &lt;pre&gt; elements, and stick it within the view-engine’s output by simple string.Replace call, injecting these &lt;pre&gt; elements into a marker location in the markup.</p>

<p>I’d then use jQuery to make these &lt;pre&gt; elements visible when clicking somewhere secret on the screen.</p>

<p> </p>

<p>The ViewFilter’s code (for reference):</p>

<p><code>
public class SqlLogFilter : IViewFilter
{
	public static readonly string SQL_LOG_PLACEHOLDER = &amp;quot;SQL_LOG_PLACEHOLDER&amp;quot;;
	public static readonly string SQL_LOG_WRITER_KEY = &amp;quot;SQL_LOG_WRITER_KEY&amp;quot;;
	public string ApplyOn(string input)
	{
		var log = &amp;quot;&amp;quot;;
		var writer = HttpContext.Current.Items[SQL_LOG_WRITER_KEY] as StringWriter;
		if (writer != null)
		{
			var lines = writer.ToString().Split(new[] { Environment.NewLine }, StringSplitOptions.RemoveEmptyEntries);
			var relevantLines =
				lines.Where(l =&gt; l.StartsWith(&amp;quot;NHibernate&amp;quot;) || l.Length &gt; 0 &amp;amp;&amp;amp; char.IsWhiteSpace(l[0])).ToArray()
				;
			var queries = string.Join(Environment.NewLine, relevantLines)
				.Split(new[] {&amp;quot;NHibernate:&amp;quot;}, StringSplitOptions.RemoveEmptyEntries)
				.Select(q =&gt; q.Trim());
			log = queries
				.Select(q =&gt; &amp;quot;&lt;pre&gt;&amp;quot; + q + &amp;quot;&lt;/pre&gt;&amp;quot;)
				.Aggregate(&amp;quot;&amp;quot;, (q1, q2) =&gt; q1 + q2);
			var count = queries.Count();
			log = &amp;quot;&lt;p&gt;Queries: &amp;quot; + count + &amp;quot;&lt;/p&gt;&amp;quot; + log;
		}
		return input.Replace(SQL_LOG_PLACEHOLDER, log);
	}
}
</code></p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2008/05/12/cloning-a-detachedcriteria">Cloning a DetachedCriteria</a></h2>
    <div class="meta">
        <time>on May 12, 2008</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            
            
        </span>
        
    </div>
    
     <p>I always need to look it up, so I might as well put it here for future reference:</p>

<p>What is a DetachedCriteria?</p>

<p>This is an ICriteria object, that is detached from any ISession, therefore is suitable to be passed around as a specification that is being built up dynamically.</p>

<p>Why would I want to clone it?</p>

<p>Well, say I want to run two similar queries (same WHERE part) but with a different projection or aggregation. For example - when fetching a paged collection, you’d want to create the spec criteria, then add Count projection on A to get the ‘total number of records’ ,and add the paging restrictions (sort, then from row 101 take 10 records). Now if you’d try to add the restrictions to the criteria to which you have already applied Count on, and error would occur.</p>

<p>Solution:</p>

<p>There’s CriteriaTransformer class, which holds a few useful static methods, amongst them, Clone(DetachedCritetia):</p>

<p>```</p>

<p>DetachedCriteria spec = DetachedCriteria.For<whadever>() ...; &lt;= setup criterionsDetachedCriteria countCriteria = CriteriaTransformer.Clone(spec)    ...; &lt;= setup the count projectionDetachedCriteria pagedCriteria = CriteriaTransformer.Clone(spec)    ...; &lt;= setup the pagingICollection<whadever> stuff = whadeverRepository.FindAll(pagedCriteria);
int total = whadeverRepository.Count(countCriteria);
```</whadever></whadever></p>


    </section>


  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2008/05/09/using-nhibernates-named-queries-with-activerecord">Using nhibernate's named queries with ActiveRecord</a></h2>
    <div class="meta">
        <time>on May 9, 2008</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            ,&nbsp;
            
            <a href="/blog/tag/hql" rel="tag">hql</a>
            
            
        </span>
        
    </div>
    
     <p>One of the methods of querying the DB when using NHibernate, is to issue <a href="http://www.hibernate.org/hib_docs/reference/en/html/queryhql.html">HQL</a> queries. HQL stands for “Hibernate Query Language”. It has a SQL-like syntax and is very intuitive for people with SQL background.</p>

<p>The way this works is that NHibernate ‘compiles’ the HQL query into SQL, and then issues the SQL query (using ADO.NET’s facilities) to the DB.</p>

<p>Sounds pricey?</p>

<p>enter Named Queries.</p>

<p>now these are HQL (or SQL) queries, each has a name (obviously), that are been supplied to NH through the mapping. The queries are being translated and cached as IDbCommand objects as part of the framework initialisation, which mean that you get rid of the HQL-&gt;SQL overhead throughout the life of the process.</p>

<p>One other major benefit, is that the mechanism to actually execute these named queries, does not differentiate between HQL and SQL queries (for the simple fact that these queries have already been transferred to SQL at runtime). That gives you the possibility to replace HQL queries into tighter SQL queries (with the same parameters and which returns the same resultset) should your DBA figure out a better one.</p>

<p>But if you’re using ActiveRecord, you usually do not have direct access into the mapping (.hbm) files. So how would you use named queries with AR?</p>

<p>enter HqlNamedQueryAttribute (not such a great name, as I did state that it would also work for SQL queries).</p>

<p>So, for an example, on this blog’s source code, within PostRepository.cs you’d see this code:</p>

<p>```</p>

<p>…</p>

<h1 id="region-queriesassembly-hqlnamedqueryqueriesfindpostsinarchive-queriesfindpostsinarchiveassembly-hqlnamedqueryqueriesfindbyurlfriendlytagname-queriesfindbyurlfriendlytagnamenamespace-kenegozicomdomain-internal-partial-class-queries--internal-const-string-findpostsinarchive---from-post-p-where--yearplifecyclecreationdate--year-and-monthplifecyclecreationdate--month--order-by-plifecyclecreationdate-desc-internal-const-string-findbyurlfriendlytagname---select-p--from--post-p--join-ptags-t-where-turlfriendlyname-like-urlfriendlytagname-order-by-plifecyclecreationdate-desc-endregion">region queries[assembly: HqlNamedQuery(Queries.FindPostsInArchive, Queries.FindPostsInArchive)][assembly: HqlNamedQuery(Queries.FindByUrlFriendlyTagName, Queries.FindByUrlFriendlyTagName)]namespace KenEgozi.Com.Domain{ internal partial class Queries { internal const string FindPostsInArchive = @” from Post p where  year(p.Lifecycle.CreationDate) = :year and month(p.Lifecycle.CreationDate) = :month  order by p.Lifecycle.CreationDate desc”; internal const string FindByUrlFriendlyTagName = @” select p  from  Post p  join p.Tags t where t.UrlFriendlyName like :urlFriendlyTagName order by p.Lifecycle.CreationDate desc;”; }}#endregion</h1>

<p>…</p>

<p>public ICollection<post> FindInArchive(int year, int month) { </post></p>

<p>return session .GetNamedQuery(Queries.FindPostsInArchive) .SetParameter(“year”, year) .SetParameter(“month”, month) .List<post>(); }</post></p>

<p>…</p>

<p>```</p>

<p>Queries class is marked as partial, as other queries might be presented on other repositories or services that would need to add more named queries. I considered grouping of queries into groups by the using repository, or by aggregate roots, but the thing is - having all of the queries under the same namespace helps discoverability, and helps with preventing duplications</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2008/02/28/executing-plain-ol-sql-in-activerecord-transaction">Executing Plain ol' SQL in ActiveRecord Transaction</a></h2>
    <div class="meta">
        <time>on February 28, 2008</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>I’m getting asked for this a lot (lately on the Castle’s usergroup, and on many other occasions)</p>

<p>You friend is <a href="http://api.castleproject.org/html/M_Castle_ActiveRecord_ActiveRecordMediator_Execute.htm">ActiveRecordMediator.Execute</a></p>

<p>So here is a sample:</p>

<p>```</p>

<p>ActiveRecordMediator.Execute(typeof(ActiveRecordBase), delegate (NHIbernate.ISession session, object data){ IDbConnection con = session.Connection; IDbCommand cmd = con.CreateCommand();</p>

<p>// That’s the key part - joining the current AR transaction scope session.Transaction.Enlist(cmd); </p>

<p>// now you have a IDbCommand instance - use it at will</p>

<p>}, null);</p>

<p>```</p>

<p>If you want to create a proper method for handling the delegate instead of the anonymous one, then you can pass data in there (using the third argument) and it would get into the delegate as the “object data” thing.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/11/19/on-linq-for-sql-and-poco">On Linq for SQL and POCO</a></h2>
    <div class="meta">
        <time>on November 19, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/linq" rel="tag">linq</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            
            
        </span>
        
    </div>
    
     <p>I’m looking at the option of using Linq To SQL for persistence.</p>

<p>Basic assumptions:
- Entities should be POCOs
- I like Linq as query language
- I hate visible generated code
- Would rather avoid xml configurations</p>

<p>Today I’m using NHibernate (so 1 and 3 are set), and AR Attributes (so 4 is set). As for querying, I resort to hql (nice, yet too stringy), ICriteria (still stringy) and NHQG (cool, super cool, yet coupled with NH, while Linq is a “query everything” language)</p>

<p>I tried Linq for SQL (on a VS C# 2008 Express Beta2). No designer. Hand coded the entity, and have used the attributes for mapping.</p>

<p>First problem encountered: in order to make a column lazy, I need to change the underlying type to Link<myoriginaltype>, and then I can tell the context (using a LoadingOptions) about whether to load the lazy properties.</myoriginaltype></p>

<p>Couldn’t yet find a way to actually lazy load that property once the instance has already been loaded.</p>

<p>I much better like the way NH is handling things, with a runtime-generated proxy that takes care of lazy loading (among other stuff), so I get it without hassling my entities code.</p>

<p>Didn’t even mention First and Second Level Caches.</p>

<p>I guess I’d have to try and hop into NHibernate.Linq, and try to help Ayende with bringing it forward. That would mean diving into NH code, something I haven’t done for quite some time now …</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/11/18/activerecord-dot-linq-naive-but-working">ActiveRecord.Linq - naive but Working</a></h2>
    <div class="meta">
        <time>on November 18, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/c-sharp" rel="tag">c-sharp</a>
            ,&nbsp;
            
            <a href="/blog/tag/linq" rel="tag">linq</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            
            
        </span>
        
    </div>
    
     <p>I’ve spent some times lately with Linq To SQL and have played a bit with the Mapping namespace.</p>

<p>Why I do not like it very much is a matter for a different post. The matter at hand is that I want the power of Linq, and I want the power of NHibernate, and I want the easy road of ActiveRecord.</p>

<p>What do I mean by that? I’d like:
- query language == Linq<br />
- persistence engine == NHibernate<br />
- Mapping == ActiveRecord attributes </p>

<p>the needed prequisites:
- Linq (framework =&gt; framework.Version &gt;= 3.5)<br />
- <a href="http://www.hookedonlinq.com/LINQToNHibernate.ashx">NHibernate.Linq</a> (source =&gt; source.getFrom(Rhino-Tools) )<br />
- Linq for ActiveRecord - Keep on Reading </p>

<p>So, <a href="http://www.ayende.com">Ayende</a> has kick-started it, and with some help from <a href="http://blogs.magiconsoftware.com/blogs/bdiaz/">Bobby Diaz</a>, we have a prototype level NHibernate provider for Linq.</p>

<p>To make it work with ActiveRecord, all you need is to add:</p>

<p><code>
using System;using Castle.ActiveRecord;using Castle.ActiveRecord.Framework;using NHibernate;namespace NHibernate.Linq{    public class ActiveRecordContext : NHibernateContext { public ActiveRecordContext() : base(null) { session = GetSession(); }  private ISession GetSession() { ISessionScope scope = SessionScope.Current; if (scope == null) throw new InvalidOperationException("You should be in a SessionScope()"); ISessionFactoryHolder holder = ActiveRecordMediator.GetSessionFactoryHolder(); return holder.CreateSession(typeof(ActiveRecordBase)); } }}
</code></p>

<p>and now you can do stuff like:</p>

<p><code>
using (new SessionScope()){ ActiveRecordContext context = new ActiveRecordContext(); var q =  from c in context.Session.Linq&lt;Category&gt;() select c;  foreach (Category c in q) Console.WriteLine(c.Name); }
</code></p>

<p>Assuming Category has [ActiveRecord] mapping.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/07/06/summing-up-the-last-two-and-a-half-years-bye-bye-sqlink">Summing up the last two and a half years - Bye bye SQLink</a></h2>
    <div class="meta">
        <time>on July 6, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/aspview" rel="tag">aspview</a>
            ,&nbsp;
            
            <a href="/blog/tag/hql" rel="tag">hql</a>
            ,&nbsp;
            
            <a href="/blog/tag/personal" rel="tag">personal</a>
            
            
        </span>
        
    </div>
    
     <p>It was absolutely brilliant.</p>

<p>I started to work for SQLink on late December 2005 as a Team Leader in the Web Projects Department.</p>

<p>Colleaged by <a href="http://www.lnbogen.com">Oren Ellenbogen</a>, it has been a pleasure. Our department head, Moti, was doing the best he can to create a very likeable working environment, and all our developers were enjoing a workplace that enabled them to learn a lot. Oren and I were directing all kinds of sessions with the developers, showing them stuff about .NET and the CLR, from “what are nullables”, through “What does the ‘using’ reserved word mean”, to “how the GC is actually working”.</p>

<p>We have built this great website called <a href="http://www.gotfriends.co.il">GotFriends</a>, that gave the company a great new source for recruiting new employees, and actually is ground breaking in the Israeli HR world. Building that site, we’ve used many technologies to make it work smoothly with the company’s inner legacy HR system, and with the aid of the SQL master Moran Benisty, it even worked in an efficient way, and coded in a maintainable manner.</p>

<p>Mixing WebForms and Monorail, CodeSmith based BLL with ActiveRecord/NH, ASP.NET WebServices (asmx) and POX/JSON services, it was a very fun thing to work on, in addition to the business benefit to the company.</p>

<p>However, a few months ago the Web Project Department was closed, and the company started a new R&amp;D team, leadedby Elad, the company’s VP of Business Development. We were two developers (Moran and I), and we worked on several initiatives that the CEO Tamir, and Elad, were cooking all the time. Those projects wereall Community-Driven-So-Called-Web-2.0-Kinda-Websites. It was a real delight, and I got the chance to learn a lot about the business side of running an Internet related initiative, as both Tamir and Elad are experienced and intelligent, and the process of refining ideas, with those two, was a real treat.</p>

<p>They also gave me the freedom to make all the technology decisions, and they’ve had enough faith in me to allow me run the projects using MonoRail and AspView, and running Castle ActiveRecord for DB access. Actually, most of the drive behind creating AspView was actually driven by Elad and Tamir, as I’ve promised to do the best I can to make sure that future additions to the team won’t need to learn Boo / Velocity in addition to learn the Monorail MVC and hql. </p>

<p>Which actually worked great. Moran has left the team about two months ago, and we’ve brought three new guys along (Ili, Ofir and last but not least, Itay), and they have seam to easily get control of all the “funky” technologies I’ve put in use in our projects.</p>

<p>Sadly enough, one of the initiatives has stalled just before airing, due to some business decisions. Then we started a new one, and in about 3 weeks we’ve had a working proof-of-concept, and I really hope that the site will air during August. I give the credit to the team, and to the use of MonoRail/ActiveRecord, as it’s such agile and suits highly-changing-environment, as most web initiatives are.</p>

<p>A point of interest: This very blog’s engine was actually a beta testing for some of the stuff we were using on our last project.</p>

<p>That’s it folks. I wish the SQLink family all the best, and I’m going to keep an eye on the cool stuff the R&amp;D team is doing, and hopefully I’ll report on their success (which would be an AspView success too …) right here on my blog.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/06/24/regionerate-c-region-maker">Regionerate - c# region maker</a></h2>
    <div class="meta">
        <time>on June 24, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/tools" rel="tag">tools</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            
            
        </span>
        
    </div>
    
     <p>Check out <a href="http://regionerate.net/">this nice tool</a> from <a href="http://blog.rauchy.net/">Omer Rauchwerger</a>.</p>

<p>It could help a team to manage a coding convention. Should be very useful in Open Source environments. For example, when committing changes to castle project (or sending a patch) there is a <a href="http://www.castleproject.org/community/codingstandards.html">coding standard</a> than needs to be followed. Regionerate could help a lot with that effort.</p>

<p>I need to see if it can select methods and properties by attributes. It could then help making MonoRail controllers and ActiveRecord decorated classes more readable (region of all actions with a “SkipFilterAttribute”, region of “Property” and region of “HasMany”, etc.)</p>

<p>UPDATE:</p>

<p>Silly me, I forgot to mention that <a href="http://weblogs.asp.net/rosherove/archive/2007/06/24/regionerate-free-code-layout-addin-for-vs-net.aspx">I found about this great tool at Roy Osherov’s blog</a>. A very good one, that is. Many <a href="http://weblogs.asp.net/rosherove/archive/tags/Agile/default.aspx">Agile related stuff</a>, and <a href="http://weblogs.asp.net/rosherove/archive/2007/06/21/que-sera-sera-a-song-about-agile-development.aspx">funny little things</a>, too. <a href="http://feeds.feedburner.com/Iserializable">So go on and subscribe to it’s feed</a>.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/06/20/eagerly-loading-multiple-collections-in-one-roundtrip">Eagerly loading multiple collections in one roundtrip</a></h2>
    <div class="meta">
        <time>on June 20, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            
            
        </span>
        
    </div>
    
     <p>Today at work I did a session with my team, showing them several methods to query the DB in a NH/AR enviroment.</p>

<p>When we talked about eager fetching, I said that doing it for more than one collection in one query isn’t good (as advised in hibernate’s site), since it might build up a rather large cartesian product.</p>

<p>Why? If we have a type Entity, that looks a bit like that:</p>

<p><code>
class Entity{ ... [HasMany ...] public IList&lt;Item&gt; Items ... [HasMany ...] public IList&lt;AnotherItem&gt; AnotherItems ... ...}
</code></p>

<p>An eager fetch will do:</p>

<p><code>
SELECT *FROM  Entities INNER JOIN Items ON Entities.Id = Items.EntityIdINNER JOIN AnotherItems ON Entities.Id = AnotherItems.EntityId
</code></p>

<p>The result length will be e<em>i</em>a, where e is the number of rows in Entities table, i is the number of rows in Items table , and a .. (you fill the blank).</p>

<p>But, luckily for us, NH is keeping a single concrete copy of each entity in a session. <a href="http://ayende.com/Blog/archive/2007/06/20/Efficently-loading-deep-object-graphs.aspx">Ayende is abusing that in a way, that makes the above possible</a>, without the 3rd (or more) dimention in the cartesian product.</p>

<p>How it works? Using a MultiCriteria,he isgettinghis entities,eagerly fetching one collection at a time. So it would return e<em>i+e</em>arows. So for the first query, NH will populate the Entity instances, with the first collection (Items) populated. For the second query, NH will populate <em>another</em> Entity instances with the second collection (AnotherItems) populated. But, since it’s in the same session, actually the first Entity instances (with Items already populated) will get their AnotherItems collection populated.</p>

<p>That’s why at the end of the snippet, you see that he actually deals with list[0]. That’s where the first set of references is placed, and the other items in that list (list[1] … list[n]) are just copies of the references to the same Entity objects.</p>

<p>Quite a similar approach was seen when <a href="http://www.ayende.com/Blog/archive/2006/11/22/7081.aspx">Ayende has shown us how to eager fetch using SQL</a> (at the end of the post). The query there returns an array of Message items and an array of User items, but the User instances actually are wired to their Message instances, so he is using only the first array.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/05/31/castle-build-from-the-trunk-revision-3812">Castle build from the trunk - revision 3812</a></h2>
    <div class="meta">
        <time>on May 31, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            
            
        </span>
        
    </div>
    
     <p>From Castle Project users group:</p>

<p>I’ve just built the trunk yesterday (rev 3812). </p>

<p>Main reason: I needed the BaseControllerTest from Castle.MonoRail.TestSupport.</p>

<p>The build was targeting .NET 2.0, in release, and no tests were run.</p>

<p>You can download it from: <a href="http://kenegozi.com/Castle_r3812_net-2.0_release_not_tested.zip">http://kenegozi.com/Castle_r3812_net-2.0_release_not_tested.zip</a>Note that it is not tested, so use it at your own risk. If you’re not going production this week, it should not be a problem …</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/05/16/my-blog-is-running-on-activerecordmonorailaspview">My blog is running on ActiveRecord-MonoRail-AspView</a></h2>
    <div class="meta">
        <time>on May 16, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            ,&nbsp;
            
            <a href="/blog/tag/aspview" rel="tag">aspview</a>
            ,&nbsp;
            
            <a href="/blog/tag/personal" rel="tag">personal</a>
            ,&nbsp;
            
            <a href="/blog/tag/blog-engine" rel="tag">blog-engine</a>
            
            
        </span>
        
    </div>
    
     <p>So long dasBlog. It was great to have you, but it’s time to move on.</p>

<p>After a lot of work, I am proud to announce that my blog is running on MonoRail, using AspView for the views, and ActiveRecord to do DB stuff.</p>

<p>Not too fancy codewise, since I have very little spare time.</p>

<p>Most of the time spent on the blog upgrade process was on:</p>

<ol>
  <li>
    <p>Exporting the data from the “old” blog, and</p>
  </li>
  <li>
    <p>making a decent markup and design for the new one.</p>
  </li>
</ol>

<p>oh. and 3. letting WindowsLiveWriter do the edits, since I wasn’t in the mood to create a backoffice.</p>

<p>I’ll blog more about the process, and I’ll make the source available.</p>

<p>Please leave your comments here about the overall look’n’feel. There must be tons of bugs and I want your feedback.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/03/19/activewriter-2nd-preview-is-out">ActiveWriter - 2nd preview is out</a></h2>
    <div class="meta">
        <time>on March 19, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/visual-studio" rel="tag">visual-studio</a>
            ,&nbsp;
            
            <a href="/blog/tag/visual-studio-2005" rel="tag">visual-studio-2005</a>
            ,&nbsp;
            
            <a href="/blog/tag/tools" rel="tag">tools</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            
            
        </span>
        
    </div>
    
     <p>ActiveWriter is a VS2005 plugin, that adds a new item type for your projects. This item is actually a visual designer for ActiveRecord classes. Quite neat, and hopefully will increase the penetration of Castle’s ActiveRecord to the “If there’s no VS wizard, I do not use it” kinda guys.</p>

<p>You can read about it and download it from <a href="http://altinoren.com/activewriter/">http://altinoren.com/activewriter/</a></p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/02/14/long-time-no-posting-must-write">Long time no posting. Must write.</a></h2>
    <div class="meta">
        <time>on February 14, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            ,&nbsp;
            
            <a href="/blog/tag/aspview" rel="tag">aspview</a>
            ,&nbsp;
            
            <a href="/blog/tag/personal" rel="tag">personal</a>
            
            
        </span>
        
    </div>
    
     <p>I haven’t written much lately, since I was:</p>

<p>a. Learning for my final exam so I’d get my Bachelor’s Degree at this decade.b. Under a lot of preassure at work, since we have a cool web2.0 thingie approaching a public beta real soon (will be followed).c.Sneasing my heart out, darn flew.d.Got into a new project at my personal business. This one is driven by Castle’s ActiveRecord+MonoRail+AspView, and due to the client’s request it’ll use Access as the backend DB, and that would be a first-time-ActiveRecord/access for me. I still hope to convince him to at-least go for embedded FireBird.</p>

<p>So, stay tuned to some experiences with AspView, and hopefully in about a month you’ll havetwo MonoRail/AspView driven websites out in the open. I am excited. Are you?</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2007/01/04/nhibernate-could-not-find-constructor-for-in-select-new-projection-query">NHibernate ' Could not find constructor for: ' in ' select new ' projection query</a></h2>
    <div class="meta">
        <time>on January 4, 2007</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/nhibernate" rel="tag">nhibernate</a>
            ,&nbsp;
            
            <a href="/blog/tag/hql" rel="tag">hql</a>
            
            
        </span>
        
    </div>
    
     <p>There are two facts here:1. I love NHibernate.2. I hate NHibernate’s exception messages.</p>

<p>And here’s my story.</p>

<p>On a project I’m working on, I need to show a projection of “top 10” from the database. let’s show this on the good old Blog scenario:<img src="http://kenegozi.com/blog/uploaded/WindowsLiveWriter/NHibernateCouldnotfindconstructorforinse_A7E6/Post-Comment-Stupid_erd_thumb%5B2%5D.gif" alt="" /></p>

<p>So I want to show the posts with the longest comments measured by the comment’s length. Stupid, huh? but it’s a demo only (I cannot expose the actual ERD). Let’s say I want the top 5.</p>

<p>I am using Castle ActiveRecord. There is a Post and a Comment classes. However, I do not wish to load Posts objects, since It will load the Comments, too, and maybe other stuff that the Post class is related to. So I have defined a PostProjection class: </p>

<p><code>
   1:  publicclass PostProjection
</code></p>

<p><code>
   2:  {
</code></p>

<p><code>
   3:  publicstring Title;
</code></p>

<p><code>
   4:  publicint Length;
</code></p>

<p><code>
   5:  public PostProjection(string title, int length)
</code></p>

<p><code>
   6:      {
</code></p>

<p><code>
   7:          Title = title;
</code></p>

<p><code>
   8:          Length = length;
</code></p>

<p><code>
   9:      }
</code></p>

<p><code>
  10:  }
</code></p>

<p>I have also added an [Import] attribute on the Post. The actual querying is done using the next hql:</p>

<p><code>
   1:  publicstatic PostProjection[] GetTopPosts(int postsToGet)
</code></p>

<p><code>
   2:  {
</code></p>

<p><code>
   3:      SimpleQuery&lt;PostProjection&gt; q =
</code></p>

<p><code>
   4:  new SimpleQuery&lt;PostProjection&gt;(typeof(Post), @"
</code></p>

<p><code>
   5:          select new PostProjection(p.Title, sum(c.LineCount)) 
</code></p>

<p><code>
   6:          from 
</code></p>

<p><code>
   7:              Post p inner join 
</code></p>

<p><code>
   8:              p.Comments c 
</code></p>

<p><code>
   9:          order by sum(o.LineCount) desc
</code></p>

<p><code>
  10:          group by p.Title");
</code></p>

<p><code>
  11:      q.SetQueryRange(postsToGet);
</code></p>

<p><code>
  12:  return q.Execute();
</code></p>

<p><code>
  13:  }
</code></p>

<p>It worked great.</p>

<p>Yesterday I’ve upgraded my Castle dll’s to the ones from build 229. It includes NHibernate 1.2.0.2002</p>

<p>Now the “select new” started to fail, and NHibernate started to claim than “Could not find constructor for: PostProjection”.</p>

<p>I’ve been scratching my head, trying various approaches, and even was keen to skip the “new” and use an object[ ] and populate the Projection Array by hand, but then I tried changing the “length” parameter of the constructor from “int” to “long”. Magically it solved the problem.</p>

<p>Now, if only NHibernate would have said :</p>

<p>Could not find constructor for: PostProjection.Looking for: PostProjection(string, long)</p>

<p>I would’ve known what the problem was, and what should I change.</p>

<p>So what have we learned today?</p>

<ol>
  <li>NHibernate expects sum() to return “long” rather than “int”2. NHibernate’s error messages suck.</li>
</ol>

<p>I’ve svn-ed the NHibernate trunk, added some code so this message would be more developer friendly, and I’m going to send the patch to NHibernate’s JIRA.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/12/03/things-ive-been-doing-lately">Things I've been doing lately</a></h2>
    <div class="meta">
        <time>on December 3, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/asp-net-2-0" rel="tag">asp-net-2-0</a>
            ,&nbsp;
            
            <a href="/blog/tag/client-side" rel="tag">client-side</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            ,&nbsp;
            
            <a href="/blog/tag/aspview" rel="tag">aspview</a>
            
            
        </span>
        
    </div>
    
     <p>I’ve been off the radar lately, due to some extensive work I do on a website for my employer.</p>

<p>It is still in early stages and I cannot talk about the site itself, but I can talk a little about the technology that drives it.</p>

<p>In one word: Castle.</p>

<p>In a few more words: </p>

<p>Data Access and OR/m: Castle’s ActiveRecord over NHibernate</p>

<p>Web UI Engine: Castle’s MonoRail</p>

<p>ViewEngine: <a href="http://kenegozi.com/blog/2006/11/27/AspViewRev38IsOut.aspx">AspView</a> (by yours truely, inspired by Ayende’s <a href="http://www.ayende.com/projects/brail.aspx">Brail</a>). All my spare time from work goes there.</p>

<p>Client Side Javascript stuff: <a href="http://prototype.conio.net/">Prototype</a> and <a href="http://script.aculo.us/">Scriptaculous</a>.</p>

<p>I really believe in the efforts made by Castle group, and I hope the the site I’m working on will be successful, as to serve for yet another prove of concept.</p>

<p>One more thing I’m doing last month, is that I’ve decided to finally end the thing with my Bachelor’s degree. I needed to retake Linear Algebra I (yep, that one the all the non-bullet-time Matrixes … I H-A-T-E adjoined matrixes. yuck) so that’s actually why AspView doesn’t progress as I’d want it too (and as some of my readers want, too).</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/11/05/building-application-using-castle-rc2">Building Application using Castle RC2</a></h2>
    <div class="meta">
        <time>on November 5, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/asp-net-2-0" rel="tag">asp-net-2-0</a>
            ,&nbsp;
            
            <a href="/blog/tag/architecture" rel="tag">architecture</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            
            
        </span>
        
    </div>
    
     <p>Ayende has recently posted a walkthrough for building Web Apps using the Castle Project’s libraries.</p>

<p>He covers ActiveRecord and MonoRail basics, showing off some of the shiny and new abilities (AR scaffolding, ARSmartDispatchers, Generics integration and so on).</p>

<p>The only thing missing is IoC-ing using Winsdor or even Binsdor. Maybe to hook some BL layer or something.</p>

<p>So it concludes (as of now) a <a href="http://www.ayende.com/Blog/BuildingApplicationsUsingCastleRC2PartI.aspx">Part I</a>, <a href="http://www.ayende.com/Blog/BuildingApplicationsUsingCastleRC2PartII.aspx">Part II</a> , and <a href="http://www.ayende.com/Blog/DemoCodeForCastleForumsDemoApp.aspx">source-code</a>.</p>

<p>If you wanna see a decent web development framework at action - tune up to those posts.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/10/26/monorail-vs-webforms">MonoRail vs. WebForms</a></h2>
    <div class="meta">
        <time>on October 26, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/asp-net-2-0" rel="tag">asp-net-2-0</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            ,&nbsp;
            
            <a href="/blog/tag/monorail" rel="tag">monorail</a>
            
            
        </span>
        
    </div>
    
     <p>Ayende <a href="http://www.ayende.com/Blog/MonoRailVsASPNet.aspx">has posted about the matter</a>, only he’ve used the title “MonoRail vs. ASP.NET” instead. I think that his title isn’t accurate since MonoRail is actually a WebForms replacement that is built ontop of ASP.NET, exploiting all of the cool features found in ASP.NET and in the .NET framework alltogether. It’s the Web development framework that Microsoft forgot. So it has the benefits of the Rails interpretaion for MVC, with the power of .NET.</p>

<p>Here is the comment I’ve posted to Ayende’s post:</p>

<p>“My point of argue in favor of MR for people who are afraid of “non-microsoft” is, that actually MR is ASP.NET. It is just not WebForms. You get all the good stuff from ASP.NET: the .NET framework for start, compiled views (on Brail - kudos to you), the HttpModule stuff, seeamless integration with AR. This is what I say to the PMs, etc. To the developers themselves who are afraid, There’s a more detailed approach. Developers (especially ones who didn’t do web programming aside ASP.NET, and probably has a lot of VB experience but no PHP/JSP/ASP) like WebForms cuz they can get to the txtUsername.Text, txtPassword.Text, and txtAge.Text easily, not needing Request.Form[“Password”] (hey - it’s not typed !!!) . But then I reffer them to the fact that actually txtAge.Text isn’t typed too. it’s a string, and should be parsed, tried, validated etc. They should also manually create a User instance, and fill it’s properties. Doing the same on MR with Dispatching and AR is there without any line of code. I show them an example aqnd then hold them as they almost fall off their chairs. Not’n like a good example. Maybe having a ViewEngine that’s use c# or VB.NET instead of boo (not the WebForm ViewEngine which suck, but somthing similar to Brail) can make the move from WebForms to easier for developers, but frankly, as you’ve said, people who can’t get it OJT with a few examples aren’t the one’s I’m likely to work with anyway.”</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/10/16/on-wheels-and-squares">On Wheels and Squares</a></h2>
    <div class="meta">
        <time>on October 16, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/miscellanea" rel="tag">miscellanea</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>On a small debate with a friend, about weather he should design and implement a Data Access Layer himself, or use an existing framework, I came across a piece by <a href="http://www.ayende.com/Blog">Ayende</a> about <a href="http://www.ayende.com/Blog/25ReasonsNotToWriteYourOwnObjectRelationalMapper.aspx">25 Reasons Not To Write Your Own Object Relational Mapper</a>.</p>

<p>I’d like to add a quote from <a href="http://www.amazon.com/gp/redirect.html?ie=UTF8&amp;location=http%3A%2F%2Fwww.amazon.com%2FCode-Complete-Second-Steve-McConnell%2Fdp%2F0735619670%2Fsr%3D8-1%2Fqid%3D1161008471%3Fie%3DUTF8%26s%3Dbooks&amp;tag=kenegoziswebl-20&amp;linkCode=ur2&amp;camp=1789&amp;creative=9325">Code Complete 2</a><img src="http://www.assoc-amazon.com/e/ir?t=kenegoziswebl-20&amp;l=ur2&amp;o=1" alt="" /> about programmers who are reluctant to read (and use) existing solutions to known problems (on p. 823): </p>

<p>… even if you want to reinvent the wheel, you can’t count on success. You might reinvent the square instead.</p>

<p>It’s definitely not a <a href="http://www.amazon.com/gp/search?ie=UTF8&amp;keywords=Dave%20Barry&amp;tag=kenegoziswebl-20&amp;index=books&amp;linkCode=ur2&amp;camp=1789&amp;creative=9325">Dave Barry</a><img src="http://www.assoc-amazon.com/e/ir?t=kenegoziswebl-20&amp;l=ur2&amp;o=1" alt="" /> kinda funny punch line, however it’s very much to-the-point.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/10/10/a-generic-execute-callback-for-activerecord-executelttgt">A Generic Execute Callback for ActiveRecord - Execute&lt;T&gt;</a></h2>
    <div class="meta">
        <time>on October 10, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/c-sharp" rel="tag">c-sharp</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>I am working with AR for a few month now, ignorantly ignoring the <a href="http://wiki.castleproject.org">Castle Project’s wiki</a>.</p>

<p>Stupid I am. I could have learned a lot and save a bunch of wandering around the net and the intellisense to learn obvious stuff.</p>

<p>Thanks to <a href="http://hammett.castleproject.org/">hammett</a> who <a href="http://kenegozi.com/blog/CommentView,guid,BCCBB3BE-CB4B-4859-A675-0C4918C0900D.aspx">pointed me there</a>.</p>

<p>Anyway - now I read it from &lt;html&gt; to &lt;/html&gt;, and I saw the part <a href="http://wiki.castleproject.org/activerecord/documentation/trunk/usersguide/hql.html#ExecCallback">about running HQL using the Execute Callback</a></p>

<p>There are examples, each one with two flavors: “not using generics”, and “using generics”. Well, the one about the Execute Callback is misleading. It should have been “not using anonymous method” and “using anonymous methods”, since the second one does not use generics.</p>

<p>So I thought - let’s make the API simpler.</p>

<p>We would have like to allow the user execute her hql like that:</p>

<p><code>
   1:  publicstatic Post[] GetPostsByAuthorName(string authorName)
</code></p>

<p><code>
   2:  {
</code></p>

<p><code>
   3:  return (Post[])Execute(typeof(Post), "from Post p where p.Author = ?", authorName);
</code></p>

<p><code>
   4:  }
</code></p>

<p>Or even better, by using generics (this time for real):</p>

<p><code>
   1:  publicstatic Post[] GetPostsByAuthorName(string authorName)
</code></p>

<p><code>
   2:  {
</code></p>

<p><code>
   3:  return Execute&lt;Post&gt;("from Post p where p.Author = ?", authorName);
</code></p>

<p><code>
   4:  }
</code></p>

<p>Here is the magic:</p>

<p><code>
   1:  publicstatic T[] Execute&lt;T&gt;(string hql, paramsobject[] parameters)
</code></p>

<p><code>
   2:  {
</code></p>

<p><code>
   3:      IList untypedResults = (IList)Execute(delegate(ISession session, object data)
</code></p>

<p><code>
   4:      {
</code></p>

<p><code>
   5:  object[] queryParams = (object[])data;
</code></p>

<p><code>
   6:          IQuery query = session.CreateQuery(hql);
</code></p>

<p><code>
   7:  for (int position = 0; position &lt; queryParams.Length; ++position)
</code></p>

<p><code>
   8:              query.SetParameter(position, queryParams[position]);
</code></p>

<p><code>
   9:  return query.List();
</code></p>

<p><code>
  10:      }, parameters);
</code></p>

<p><code>
  11:      T[] results = new T[untypedResults.Count];
</code></p>

<p><code>
  12:      untypedResults.CopyTo(results, 0);
</code></p>

<p><code>
  13:  return results;
</code></p>

<p><code>
  14:  }
</code></p>

<p>I’ll add an overload that will accept named parameters. I am not sure about the right way to do that, though.</p>

<p>My options are:</p>

<p><code>
   1:  Execute&lt;T&gt;(string hql, 
</code></p>

<p><code>
   2:  string[] paramNames, 
</code></p>

<p><code>
   3:      Type[] paramTypes, 
</code></p>

<p><code>
   4:  object[] parameters)
</code></p>

<p>Or:</p>

<p><code>
   1:  Execute&lt;T&gt;(string hql, IParameter[] parameters)
</code></p>

<p>where IParameter definition is something like:</p>

<p><code>
   1:  publicinterface IParameter&lt;T&gt;
</code></p>

<p><code>
   2:  where T: Type
</code></p>

<p><code>
   3:  {
</code></p>

<p><code>
   4:  publicstring Name { get; set;}
</code></p>

<p><code>
   5:  public T Value { get; set;}
</code></p>

<p><code>
   6:  }
</code></p>

<p>Maybe both?</p>

<p>And maybe I haven’t read the wiki thoroughly enough and there are already implementations for all that?</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/10/08/projection-using-activerecords-importattribute-and-hqls-select-new-clause">Projection using ActiveRecord's ImportAttribute and HQL's select new clause</a></h2>
    <div class="meta">
        <time>on October 8, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>WARNING:I’m going to use some lousy examples in this post. Please bear with me, and stick to the Point rather than to the actual Classes being presented.</p>

<p>What is a projection?</p>

<p>Consider this genius ERD:</p>

<p><img src="http://kenegozi.com/blog/uploaded/WindowsLiveWriter/ProjectingtononActiveRecordclassesusingA_C76B/Post_Comment_Genius_ERD_thumb3.gif" alt="" /></p>

<p>A sample projection could be a kind of a view:</p>

<p><img src="http://kenegozi.com/blog/uploaded/WindowsLiveWriter/ProjectingtononActiveRecordclassesusingA_C76B/CommentView_Genius_ERD_thumb1.gif" alt="" /></p>

<p>The SQL is (surprise!)</p>

<p><code>
   1:  SELECT
   2:      p.Title as PostTitle, c.Content
   3:  FROM 
   4:      Comments c INNER JOIN
   5:      Posts p ON c.PostId = p.Id
</code></p>

<p>But we live in the Classes/Code/Compiler/Types/etc. domain, not the SQL domain, so I’d need a Post and a Comment classes that would derive from ActiveRecordBase&lt;&gt;. But what about the CommentsView? I can select into an array of objects using a simple HQL’s select:</p>

<p><code>
   1:  IActiveRecordQuery query = new HqlBasedQuery(typeof(Job),
</code>
   2:  “select c.Post.Title, c.Content from Comment as c”);   3:     4:  ArrayList report = ActiveRecordMediator.ExecuteQuery(query) as ArrayList;
But I do not want to, since every item in the ArrayList is of type object[]. yuck.</p>

<p>No, I want to use a CommentView class, and this syntax:
   1:  IActiveRecordQuery query = new HqlBasedQuery(typeof(Job),
   2:  “select new CommentView(c.Post.Title, c.Content) from Comment as c”);
   3:<br />
   4:  ArrayList report = ActiveRecordMediator.ExecuteQuery(query) as ArrayList;
and now the ArrayList contains CommentView objects.</p>

<p>In order to achieve that, we need to use the peculiar named attribute, [Import] like that:</p>

<p><code>
   1:  [Import(typeof(CommentView), "CommentView")]
   2:  [ActiveRecord("Comments")]
   3:  publicclass Comment : ActiveRecordBase&lt;Comment&gt; { /* blah blah */ }
</code></p>

<p>Now ActiveRecord (assuming Comment class was initialized using ActiveRecordStarter) knows that CommentView refers to a projection of the Comment ActiveRecord, using the class CommentView.</p>

<p>The use of [Import] is not documented too well, so I’ve included ImportAttribute in the post’s title so It could be easily found. After a few refinements I hope to post it to the CastleProject wiki.</p>

<p>Note <a href="http://www.ayende.com/Blog/ActiveRecordAndASPNet20.aspx">Ayende’s post</a>, with some better example for projection, but it lacks the demonstration of using Import attribute, so that’s actually the reason for this post.</p>

<p>That’s for the “how you do that”.</p>

<p>now for the “How I think you should be able to do that”:</p>

<p>well, INHO, the Import attribute is poorly named.</p>

<p>The name of the Attribute makes no sense to me.The lack of default name makes no sense to me. I should be able to </p>

<p><code>
   1:  [Import(typeof(CommentView))] 
</code></p>

<p>And what if I need some different projections to the same AR type? Multiple Import attributes make no sense, too. </p>

<p>Does the Import attribute serves a different purpose? If not – why not call it “Projects”? (since it projectsto some other classes)</p>

<p>like:</p>

<p><code>
   1:  [Projects(typeof(CommentProjectionOrWhatever))] 
   2:  publicclass Comment : ActiveRecordBase&lt;Comment&gt; { /* blah blah*/ }
</code></p>

<p>or even better yet: </p>

<p><code>
   1:  [Projects(
   2:  typeof(CommentProjectionOrWhatever), 
   3:  typeof(YetAnotherCommentProjectionNeededForDemonstrationPurposesOnly )]
</code></p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/09/07/inheritence-in-castles-activerecord">Inheritence in Castle's ActiveRecord</a></h2>
    <div class="meta">
        <time>on September 7, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/c-sharp" rel="tag">c-sharp</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>The reference I’ve used whilelearning to use Castl’e ActiveRecord implementation is the Blog/Post demos that can be found on Castle’s site.</p>

<p>Let’s look at the Type Hierarchy example, that can be found here.</p>

<p>It shows an implementation of a class diagram that look a little bit like this:<img src="http://kenegozi.com/blog/uploaded/Company_Entity_Person_Class_Diagram.GIF" alt="Class Diagram" /></p>

<p>Let’s look at the code :
[ActiveRecord(“entity”), JoinedBase]publicclassEntity : ActiveRecordBase{privateint _id;[PrimaryKey]publicint Id{get { return id; }set { id = value; }}}[ActiveRecord(“entitycompany”)]publicclassCompanyEntity : Entity{privateint comp_id;[JoinedKey(“comp_id”)]publicint CompId{get { return comp_id; }set { comp_id = value; }}}[ActiveRecord(“entityperson”)]publicclassPersonEntity : Entity{privateint person_id;[JoinedKey(“person_id”)]publicint PersonId{get { return person_id; }set { person_id = value; }}}
But look what happens. since the Id property on entity is public and inherited to the subclasses, you get something like this:<img src="http://kenegozi.com/blog/uploaded/IdOrPersonId.GIF" alt="Should I use .Id or .PersonId?" /></p>

<p>So there is a duplicate field here !!!. and it’s not only a getter-setter thingie. It also have different private members.</p>

<p>My solution for this is to virtualize the base Id, and protectedize (hehe) the _id member, like this:</p>

<p>[ActiveRecord(“entity”), JoinedBase]publicclassEntity : ActiveRecordBase{protectedint _id;[PrimaryKey]publicvirtualint Id{get { return id; }set { id = value; }}}[ActiveRecord(“entitycompany”)]publicclassCompanyEntity : Entity{[JoinedKey(“comp_id”)]publicoverrideint Id{get { return _id; }set { _id = value; }}}[ActiveRecord(“entityperson”)]publicclassPersonEntity : Entity{[JoinedKey(“person_id”)]publicoverrideint Id{get { return _id; }set { _id = value; }}}
Now it makes more sence:<img src="http://kenegozi.com/blog/uploaded/NowOnlyId.GIF" alt="I should use .Id" /></p>

<p>And before you hit me with a big stick - I do know of ActiveRecordBase<t> . :) the above code is for demonstration purposes only, not to be Copy&amp;Pasted to your Brand-New-Best-Erp-Ever-Made-And-Will-Make-You-Rich</t></p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/08/26/activerecordbase-vs-activerecordmediator">ActiveRecordBase vs ActiveRecordMediator</a></h2>
    <div class="meta">
        <time>on August 26, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/architecture" rel="tag">architecture</a>
            ,&nbsp;
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>So after a lot of talking about the matter, I’m starting a little (but real) project with <a href="http://www.castleproject.org/index.php/ActiveRecord">Castle’s ActiveRecord</a> as an ORM service.</p>

<p>What I’m still not sure about, is weather I should inherit everything from <a href="http://castleproject.org/API/Castle.ActiveRecord.ActiveRecordBase.html">ActiveRecordBase</a>, or have my own base class and use <a href="http://castleproject.org/API/Castle.ActiveRecord.ActiveRecordMediator.html">ActiveRecordMediator</a>?</p>

<p>Sure, I can derive my base class from ActiveRecordBase and have common behaviour for my model, but I am still not sure that I’m fully into the ActiveRecord pattern as a whole. It’s tempting to exploit Castle’s implementation but to keep the methods in a seperate class rather than in the model itself.</p>

<p>I also have some problem with the need to do FindAll, Find, etc. on each class so to expose the static methods in a typed way.</p>

<p>Well, I take back the last paragraph, since Icould use ActiveRecordBase&lt;&gt; and it solves this problem.</p>

<p>To conclude: I tend to go with subclassing ActiveRecordBase&lt;&gt; as a base class for my model, and I’m starting to code (and test) that way,but I could still use the knowledge gained by people with real experience withthis implementation…</p>

<p>I’ve looked for insights on the matter on the web, and have found nothing.If anyone reading this has an insight about the matter, please comment here, so people who do their first steps in Castle’s ActiveRecord implementation would have a better kick start regarding this issue.</p>


    </section>


  
  
  
  
  
  
  
  
    

    <section class="container content post">
    <h2><a href="/blog/2006/08/26/activerecord-beginners-resources">ActiveRecord Beginner's Resources</a></h2>
    <div class="meta">
        <time>on August 26, 2006</time>&nbsp;&nbsp;
        <span class="tags">
            
            <a href="/blog/tag/castle" rel="tag">castle</a>
            ,&nbsp;
            
            <a href="/blog/tag/activerecord" rel="tag">activerecord</a>
            
            
        </span>
        
    </div>
    
     <p>I’ll post here links for stuff that I find usefull, for people who are doing their first steps in the Castle’s ActiveRecord’s world.</p>

<p>This post is to be updated while finding more resources.</p>

<p>Note that this is not a replacement for the official ducomentation that can be found on Castle’s website, but merely a place to do the beginner’s life somewhat easier.</p>

<p>Posts by <a href="http://hammett.castleproject.org/">Hamilton <em>hammett</em> Verissimo</a>, who is the engine behind the whole story:<a href="http://geekswithblogs.net/hammett/articles/76697.aspx">http://geekswithblogs.net/hammett/articles/76697.aspx</a><a href="http://geekswithblogs.net/hammett/articles/76809.aspx">http://geekswithblogs.net/hammett/articles/76809.aspx</a>make sure that you are following <a href="http://hammett.castleproject.org/">his blog</a>.</p>

<p>An article by Ayende about using Generics with ActiveRecord:[http://www.castleproject.org/index.php/ActiveRecord,<em>.Net_2.0_and_Generics](http://www.castleproject.org/index.php/ActiveRecord,</em>.Net_2.0_and_Generics)as before - stay tuned to <a href="http://www.ayende.com/blog">Ayende’s blog</a> for he very experienced in ActiveRecord and in NHibernate too, for the matter. He is also avery readablewriter.</p>


    </section>


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</section>


	<!-- FOOTER -->
	<footer id="footer" class="section">
		<div class="container">
			<p class="copyright pull-left">
				&copy; 2014. Ken Egozi. All Rights Reserved.
				<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
					<img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
				</a>
				</p>
		</div>
	</footer>
	<!-- END FOOTER -->
	<div class="back-to-top">
		<a href="#top"><i class="fa fa-chevron-up"></i></a>
	</div>

	<script src="/assets/javascripts/jquery-2.1.0.min.js"></script>
	<script src="/assets/javascripts/jquery.localScroll.min.js"></script>
	<script src="/assets/javascripts/looper.min.js"></script>
	<script src="/assets/javascripts/bootstrap.min.js"></script>
	<script src="/assets/javascripts/site.js"></script>
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-431307-1']);
		_gaq.push(['_setDomainName', '.kenegozi.com']);
		_gaq.push(['_trackPageview']);

		$(function () {
			var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

			$.getScript(src);
		});
	</script>
</body>
</html>
